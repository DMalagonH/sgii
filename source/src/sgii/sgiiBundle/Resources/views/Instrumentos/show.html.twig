{% extends "::base.html.twig" %}

{% block menu %}
    {% set origen = 'instrumentos' %}
    {% include '::menu_principal.html.twig' %}
{% endblock menu %}

{% block style %}
<style>
    #ol-opciones li{
        margin-bottom: 2px;
    }
    
</style>
{% endblock style %}

{% block body %}
<div class="row-fluid">
    <div class="span8">
        <h1>{{ instrumento.theNombreHerramienta }}: {{ instrumento.herNombreHerramienta }}</h1>
        {% if instrumento.proNombre %} En el proyecto: {{ instrumento.proNombre }}{% endif %}
    </div>
    <div class="span4">
        {% if instrumento.herEstado %}<span class="label label-success">Activo</span>{% else %}<span class="label label-inverse">Inactivo</span>{% endif %}
        <br/>
        {% if instrumento.herFechaInicio %}Desde: {{ instrumento.herFechaInicio|date('Y-m-d') }}<br/>{% endif %}
        {% if instrumento.herFechaFin %}Hasta: {{ instrumento.herFechaFin|date('Y-m-d') }}{% endif %}
    </div>
</div>
<div class="row-fluid sortable">
    <div class="box span7">
        <div class="box-header well" data-original-title>
            <h2><i class="icon-tasks"></i> Preguntas</h2>
            <div class="box-icon">
                <a href="#" class="btn btn-minimize btn-round"><i class="icon-chevron-up"></i></a>
            </div>
        </div>
        <div class="box-content">
            
        </div>
    </div>
    <div class="box span5">
        <div class="box-header well" data-original-title>
            <h2><i class="icon-edit"></i> Crear pregunta</h2>
            <div class="box-icon">
                <a href="#" class="btn btn-minimize btn-round"><i class="icon-chevron-up"></i></a>
            </div>
        </div>
        <div class="box-content">
            <form class="form-horizontal" action="{{ path('show_instrumento', {'id':instrumento.id}) }}" method="POST" style="margin-bottom: 0px;">
                <fieldset>
                    <div class="control-group" style="margin-bottom: 8px;">
                        Tipo de pregunta:
                        {{ form_widget(form.tipoPregunta, {'attr':{'class':'input-large span12'} }) }}                                
                    </div>
                    <div class="control-group" style="margin-bottom: 8px;">
                        Pregunta:
                        {{ form_widget(form.pregunta, {'attr':{'class':'input-large span12'} }) }}                                
                    </div>
                    <div class="control-group" style="margin-bottom: 8px;">
                        Obligatoria:
                        {{ form_widget(form.obligatoria) }}                                
                    
                        Activa:
                        {{ form_widget(form.estado) }}                                
                    </div>
                    <div class="control-group" style="margin-bottom: 8px;">
                        Orden:
                        {{ form_widget(form.orden, {'attr':{'class':'span2', 'type':'numeric'} }) }}                                
                    </div>
                    <div class="control-group div-opciones" style="display: none; margin-bottom: 4px;">
                        <span>Opciones de respuesta:</span>
                        <a id="btn-add-opcion" class="btn btn-primary btn-info btn-mini" href="#" data-rel="tooltip" title="Agregar opciÃ³n">
                            <i class="icon-plus icon-white"></i>
                        </a>
                    </div>
                    <div class="control-group div-opciones" style="display: none; margin-bottom: 8px;">
                        <ol id="ol-opciones">
                            <li>
                                <input type="text" name="opciones[]" class="input-large span10" style="display:inline;"/>
                            </li>
                            <li>
                                <input type="text" name="opciones[]" class="input-large span10" style="display:inline;"/>
                            </li>
                        </ol>
                    </div>
                    {{ form_errors(form) }}
                    {{ form_widget(form._token) }}
                    <div class="control-group" style="margin-bottom: 8px; text-align: right;">
                        <input type="submit" value="Crear pregunta" class="btn btn-primary btn-info"/>
                    </div>
                </fieldset>
            </form>
        </div>
    </div>
</div>
{% endblock body %}

{% block script %}
<script>
    $(document).ready(function () {
        $('#form_tipoPregunta').on('change', function(){
            
            if($(this).val() == 1) // preguntas abiertas
            {
                $(".div-opciones").hide();
                $("#ol-opciones li input").removeAttr('required');
            }
            else // pregutnas cerradas
            {
                $(".div-opciones").show();
                $("#ol-opciones li input").attr('required','required');
            }
        });
        
        $("#ol-opciones").on('click', '.btn-delete-opcion', function(){
            console.log('remove');
            $(this).parent().remove();
        });
        
        $("#btn-add-opcion").on('click', function(){
            $("#ol-opciones").append('<li><input type="text" name="opciones[]" required="required" class="input-large span10" style="display:inline;"/> <a class="btn btn-danger btn-mini btn-delete-opcion" data-rel="tooltip" title="Eliminar"><i class="icon-trash icon-white"></i></a></li>');
        });
    });
</script>
{% endblock script %}